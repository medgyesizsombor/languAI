<ion-content [fullscreen]="true" class="ion-padding">
  <app-header
    [useNavController]="true"
    [showBackArrow]="true"
    (click)="navigateBack()"
    [title]="title"></app-header>

  <!-- ACTION BUTTONS -->
  <ion-row class="pb-5" *ngIf="isProfileOfSomeoneElse">
    <ion-col class="ion-align-items-center me-1">
      <ion-button
        class="primary-button request-button w-100 no-shadow"
        (click)="friendshipViewModel?.requesterId === userId ? sendRequest() : reactFriendshipRequest()"
        [ngSwitch]="friendshipViewModel?.status">
        <span *ngSwitchCase="friendshipStatusEnum.Requested">
          <span
            *ngIf="friendshipViewModel?.requesterId === userId; else acceptFriendshipRequest">
            {{ 'SENT_FRIEND_REQUEST' | translate }}
          </span>
        </span>
        <span *ngSwitchCase="friendshipStatusEnum.Accepted">
          {{ 'FRIEND' | translate }}
        </span>
        <span *ngSwitchDefault>{{ 'SEND_FRIEND_REQUEST' | translate }}</span>
      </ion-button>
    </ion-col>
    <ion-col size="auto" class="pb-1">
      <ion-button
        class="mt-0 primary-button-outline no-shadow"
        *ngIf="friendshipViewModel?.status === friendshipStatusEnum.Requested
        && friendshipViewModel?.requesterId === userId; else rejectFriendshipRequest">
        <ion-icon name="chatbubble-ellipses-outline"></ion-icon>
      </ion-button>
    </ion-col>
  </ion-row>

  <!-- BADGES -->
  <ion-row class="ion-justify-content-center pb-1">
    <ion-badge
      class="me-4 px-4 py-1"
      [ngClass]="{ 'active-badge': activeBadge === badgeEnum.details }"
      (click)="setActiveBadge(badgeEnum.details)">
      {{ 'DETAILS' | translate }}
    </ion-badge>
    <ion-badge
      class="me-4 px-4 py-1"
      [ngClass]="{ 'active-badge': activeBadge === badgeEnum.posts }"
      (click)="setActiveBadge(badgeEnum.posts)">
      {{ 'POSTS' | translate }}
    </ion-badge>
    <ion-badge
      class="px-4 py-1"
      [ngClass]="{ 'active-badge': activeBadge === badgeEnum.cards }"
      (click)="setActiveBadge(badgeEnum.cards)">
      {{ 'CARDS' | translate }}
    </ion-badge>
  </ion-row>

  <div [ngSwitch]="activeBadge">
    <ng-container *ngSwitchCase="badgeEnum.details">
      <ng-container *ngTemplateOutlet="details"></ng-container>
    </ng-container>
    <ng-container *ngSwitchCase="badgeEnum.posts">
      <ng-container *ngTemplateOutlet="posts"></ng-container>
    </ng-container>
    <ng-container *ngSwitchCase="badgeEnum.cards">
      <ng-container *ngTemplateOutlet="cards"></ng-container>
    </ng-container>
  </div>

  <ng-template #details>
    <!-- DETAILS -->
    <form *ngIf="profileForm" [formGroup]="profileForm" class="pb-5">
      <!-- USERNAME -->
      <ion-row>
        <ion-col>
          <ion-row class="line">
            <ion-col size="1.5" class="align-item-center fs-24 ps-0 form-col">
              <ion-icon name="person-outline"></ion-icon>
            </ion-col>
            <ion-col class="form-col">
              <ion-input
                id="username-input"
                name="username-input"
                [ngClass]="isEdit ? 'edit-mode' : 'readonly-mode'"
                type="text"
                [autocomplete]="false"
                formControlName="username"
                placeholder="{{ 'USERNAME' | translate}}"></ion-input>
            </ion-col>
          </ion-row>
        </ion-col>
      </ion-row>

      <!-- EMAIL -->
      <ion-row>
        <ion-col>
          <ion-row class="line">
            <ion-col size="1.5" class="align-item-center fs-24 ps-0 form-col">
              <ion-icon name="mail-outline"></ion-icon>
            </ion-col>
            <ion-col class="form-col">
              <ion-input
                id="email-input"
                name="email-input"
                [ngClass]="isEdit ? 'edit-mode' : 'readonly-mode'"
                type="email"
                formControlName="email"
                placeholder="{{ 'EMAIL' | translate}}"></ion-input>
            </ion-col>
          </ion-row>
        </ion-col>
      </ion-row>

      <!-- LANGUAGE -->
      <ion-row *ngIf="!isProfileOfSomeoneElse">
        <ion-col>
          <ion-row class="line">
            <ion-col size="1.5" class="align-item-center fs-24 ps-0 form-col">
              <ion-icon name="language-outline"></ion-icon>
            </ion-col>
            <ion-col class="form-col">
              <ion-select
                [ngClass]="isEdit ? 'edit-mode' : 'readonly-mode'"
                formControlName="language"
                (ngModelChange)="changeLanguage()">
                <ion-select-option
                  *ngFor="let language of languages"
                  [value]="language.id">
                  {{ language.name!.toUpperCase() | translate }}
                </ion-select-option>
              </ion-select>
            </ion-col>
          </ion-row>
        </ion-col>
      </ion-row>

      <!-- DATE OF BIRTH -->
      <ion-row>
        <ion-col>
          <ion-row class="line d-flex">
            <ion-col size="1.5" class="align-item-center fs-24 ps-0 form-col">
              <ion-icon name="calendar-outline"></ion-icon>
            </ion-col>
            <ion-col class="ion-align-content-start form-col">
              <div class="d-flex">
                <ion-datetime-button
                  [ngClass]="isEdit ? 'edit-mode' : 'readonly-mode'"
                  [disabled]="!isEdit"
                  datetime="datetime"></ion-datetime-button>
                <ion-modal [keepContentsMounted]="true">
                  <ng-template>
                    <ion-datetime
                      #datetime
                      formControlName="dateOfBirth"
                      presentation="date"
                      id="datetime"
                      [showDefaultButtons]="true"
                      doneText="{{ 'OK' | translate }}"
                      cancelText="{{ 'CANCEL' | translate }}">
                      <span slot="title">{{ 'SELECT_YOUR_BIRTHDAY' }}</span>
                    </ion-datetime>
                  </ng-template>
                </ion-modal>
              </div>
            </ion-col>
          </ion-row>
        </ion-col>
      </ion-row>
    </form>

    <ng-container *ngIf="!isEdit; else edit">
      <ion-row>
        <ion-button
          (click)="changeEditMode()"
          class="ion-padding-horizontal primary-button w-100 pb-4 no-shadow">
          {{ 'EDIT_PROFILE' | translate }}
        </ion-button>
      </ion-row>
      <ion-row>
        <ion-button
          (click)="changePassword()"
          class="primary-button-outline w-100 ion-padding-horizontal no-shadow">
          {{ 'CHANGE_PASSWORD' | translate }}
        </ion-button>
      </ion-row>
    </ng-container>
  </ng-template>

  <ng-template #edit>
    <ion-row>
      <ion-button
        (click)="save()"
        class="ion-padding-horizontal primary-button w-100">
        {{'EDIT_PROFILE' | translate}}
      </ion-button>
    </ion-row>
    <ion-row>
      <ion-button
        class="ion-padding-horizontal primary-button-outline w-100"
        (click)="changeEditMode()">
        {{'CANCEL' | translate}}
      </ion-button>
    </ion-row>
  </ng-template>

  <!-- POSTS -->
  <ng-template #posts></ng-template>

  <!-- CARD -->
  <ng-template #cards>
    <ion-list
      class="d-flex ion-wrap ion-justify-content-center ion-no-padding pt-4">
      <ion-card
        class="border-2 flash-cards"
        *ngFor="let cardList of cardLists"
        (click)="openCardList(cardList.id!)">
        <!--TODO megcsinálni a listát-->
        <ion-card-header class="ion-text-center border-2-bottom-line">
          {{ cardList.modified | date:'YYYY. MM. dd' }}
        </ion-card-header>
        <ion-card-content>
          <ion-row>
            <ion-label class="w-100">{{ cardList.name }}</ion-label>
          </ion-row>
          <ion-row>
            <ion-label class="w-100">
              {{ cardList.created | date:'YYYY. MM. dd' }}
            </ion-label>
          </ion-row>
        </ion-card-content>
      </ion-card>
    </ion-list>
  </ng-template>

  <ng-template #acceptFriendshipRequest>
    <span>{{ 'ACCEPT_FRIENDSHIP' | translate }}</span>
  </ng-template>

  <ng-template #rejectFriendshipRequest>
    <ion-button
      class="mt-0 error-outline-button no-shadow"
      (click)="reactFriendshipRequest(false)">
      <ion-icon name="close-circle-outline"></ion-icon>
    </ion-button>
  </ng-template>
</ion-content>
